<div class="container">
  <table class="table table-bordered border-green align-middle">
    <thead>
      <tr>
        <th scope="col">Fecha</th>
        <th scope="col">ID</th>
        <th scope="col">Nombre</th>
        <th scope="col">Entrada</th>
        <th scope="col">Salida</th>
      </tr>
    </thead>
    <tbody>
    <% @attendances.each do |e| %>
      <tr>
        <td><%= e.created_at.strftime('%d / %B / %Y') %></th>
        <td><%= e.employee_id %></td>
        <td><%= e.employee.name %></td>
        <% if e.direction == 'Check-in'%>
          <td><%= e.created_at.strftime('%T') %></td>
        <% else %>
          <td></td>
        <% end %>
        <% if e.direction == 'Check-out'%>
          <td><%= e.created_at.strftime('%T') %></td>
        <% else %>
          <td></td>
        <% end %>
      </tr>
    <% end %>
    </tbody>
  </table>
</div>

<div class="container">
  <h3>Promedio de entrada y salida de los empleados</h3>
  <strong>Entrada</strong><p><%= @avgIn %></p>
  <strong>Salida</strong><p><%= @avgOut %></p>
</div>

<div class="container">
  <h3>Ausencia por mes</h3>
  <table class="table border-bottom border-dark w-100 text-center mt-4 table-hover">
  <tr class="">
    <th>ID</th>
    <th>NAME</th>
    <th>DAYS WITHOUT CHECK</th>
  </tr>
  <% @ausencia.each do |employee|  %>
    <% result = (employee.attendances.group_by_day(:created_at, range: employee.attendances.minimum(:created_at)..Time.now).count)%>
    <% daysNo = result.select { |k, v| v == 0 }.keys %>
    <tr>
      <td><%= employee.id %></td>
      <td><%= employee.name %></td>
      <td>
        <% daysNo.each do |d| %>
          <%= simple_format "#{d.strftime('%d / %B / %Y')} \n" %>
        <% end %>
      </td>
    </tr>
  <% end %>
  </table>
</div>

